@{
    ViewBag.Title = "Tablero - Mariana Sánchez";
}

<canvas id="c" width="670" height="400" style="border: 1px #000 solid; cursor: pointer; background-color: black;"></canvas>
<div class="btn-toolbar" role="toolbar">
    <div class="btn-group btn-group-lg">
        <button type="button" class="btn btn-default color"><span class="glyphicon glyphicon-stop" data-toggle="tooltip" data-placement="bottom" title="Green" style="color: green;"></span></button>
        <button type="button" class="btn btn-default color"><span class="glyphicon glyphicon-stop" data-toggle="tooltip" data-placement="bottom" title="Red" style="color: red;"></span></button>
        <button type="button" class="btn btn-default color"><span class="glyphicon glyphicon-stop " data-toggle="tooltip" data-placement="bottom" title="Yellow" style="color: yellow;"></span></button>
        <button type="button" class="btn btn-default color"><span class="glyphicon glyphicon-stop " data-toggle="tooltip" data-placement="bottom" title="Blue" style="color: blue;"></span></button>
        <button type="button" class="btn btn-default color"><span class="glyphicon glyphicon-stop " data-toggle="tooltip" data-placement="bottom" title="Magenta" style="color: magenta;"></span></button>
        <button type="button" class="btn btn-default color"><span class="glyphicon glyphicon-unchecked " data-toggle="tooltip" data-placement="bottom" title="White" style="color: papayawhip;"></span></button>
        <button type="button" class="btn btn-default color"><span class="glyphicon glyphicon-stop " data-toggle="tooltip" data-placement="bottom" title="Black" style="color: black;"></span></button>
        <button type="button" class="btn btn-default color"><span class="glyphicon glyphicon-stop " data-toggle="tooltip" data-placement="bottom" title="Brown" style="color: brown;"></span></button>
    </div>
    <div class="btn-group btn-group-lg">
        <button type="button" class="btn btn-default reset"><span class="glyphicon glyphicon-trash " data-toggle="tooltip" data-placement="bottom" title="Reset - erases everything" style="color: black;"></span></button>
        <button type="button" class="btn btn-default eraser"><span class="glyphicon glyphicon-minus-sign " data-toggle="tooltip" data-placement="bottom" title="Eraser - increases line width" style="color: black;"></span></button>
        <button type="button" class="btn btn-default export"><span class="glyphicon glyphicon-floppy-disk" data-toggle="tooltip" data-placement="bottom" title="Save drawing"></span></button>
        <button type="button" class="btn btn-default">Background</button>
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
            <span class="sr-only">Toggle Dropdown</span>
        </button>
        <ul class="dropdown-menu" role="menu">
            <li><a href="#" class="switch-back">White</a></li>
            <li><a href="#" class="switch-back">Black</a></li>

        </ul>
    </div>
</div>
<div id="status"></div>
@section scripts
{
    @Scripts.Render("~/bundles/Tablero")
    @Scripts.Render("~/bundles/signalr")

    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script>

        //var tablero;
        $(function() {

            $('span[data-toggle="tooltip"]').tooltip();

            var tablero = null;
            var tableroHub = $.connection.tableroHub;

            tableroHub.client.reset = function(received) {
                tablero.reset();
            };

            tableroHub.client.draw = function(coords, lineWidth) {

                tablero.draw(coords, lineWidth);
            };

            tableroHub.client.changeColor = function(color) {
                tablero.changeColor(color);
            };

            $.connection.hub.start().done(function() {

                tablero = $('#c').Tablero({
                    remoteDraw: function(coords, width) {
                        tableroHub.server.draw(coords, width);
                    }
                });
            });

            $('.reset').click(function() {
                tableroHub.server.reset();

                tablero.reset();
            });

            $('.eraser').click(function() {
                tablero.eraser();
            });

            $('.switch-back').click(function() {
                tablero.changeBackgroundColor($(this).text());

            });

            $('.export').click(function () {
                tablero.exportImage();
            });
            
            //prevent scrolling
            document.body.addEventListener('touchmove', function(event) {
                event.preventDefault();
            }, false);

            $('.color').click(function() {
                var color = $(this).find('span').css('color');
                tablero.changeColor(color);
                tableroHub.server.changeColor(color);
            });


        });
    </script>
}
