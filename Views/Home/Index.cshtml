@{
    ViewBag.Title = "Tablero";
}

<canvas id="c" width="900" height="400" style="border: 1px #000 solid; cursor: pointer; background-color: black;"></canvas>
<div id="log" style="width: 200px; max-height: 90px; overflow: scroll;"></div>
@section scripts
{
    <script src="~/Scripts/Tablero.js"></script>
    <script src="~/Scripts/jquery.signalR-2.0.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script>

        
     

        //var tablero;
        $(function() {

            var tablero = null;
            
            var tableroHub = $.connection.tableroHub;
            
           
            tableroHub.client.reset = function (received) {
                tablero.reset();
            };

            tableroHub.client.startPaint = function (x, y) {
                tablero.startPaint(x, y);
                
            };

            tableroHub.client.endPaint = function () {

                tablero.endPaint();
            };

            tableroHub.client.draw = function (x, y) {

                tablero.draw(x, y);
            };

            tableroHub.client.changeColor = function (color) {
                tablero.changeColor(color);
            };



            $.connection.hub.start().done(function() {

                tablero = $('#c').Tablero({
                    remoteStartPaint: function (x, y) {
                        tableroHub.server.startPaint(x, y);
                    },
                    remoteEndPaint: function () {
                        tableroHub.server.endPaint();
                    },
                    remoteDraw: function (x, y) {
                        tableroHub.server.draw(x, y);
                    }
                });

               
               
               
            });
            
            $('.reset').click(function () {
                tableroHub.server.reset();
                console.log(tablero);
                tablero.reset();
            });

           
            //prevent scrolling
            document.body.addEventListener('touchmove', function (event) {
                event.preventDefault();
            }, false);

            $('.color').click(function () {
                var color = $(this).find('i').css('color');
                tablero.changeColor(color);
                tableroHub.server.changeColor(color);
            });

          
        });
    </script>
}
