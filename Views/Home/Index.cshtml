@{
    ViewBag.Title = "Tablero";
}

<canvas id="c" width="900" height="400" style="border: 1px #000 solid; cursor: pointer; background-color: black;"></canvas>

@section scripts
{
    <script src="~/Scripts/Tablero.js"></script>
    <script src="~/Scripts/jquery.signalR-2.0.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script>

        var tableroHub = $.connection.tableroHub;
        tableroHub.client.hello = function(received) {
            
        };

        tableroHub.client.createNewTablero = function(received) {
            tablero.createNew(900, 400, 'c');
        };
        
        tableroHub.client.startPaint = function (x,y) {
            tablero.startPaint(x, y);
        };
        
        tableroHub.client.endPaint = function () {
            tablero.endPaint();
        };
        
        tableroHub.client.draw = function (x,y) {
            tablero.draw(x,y);
        };

        tableroHub.client.changeColor = function (color) {
            tablero.changeColor(color);
        };


        $.connection.hub.start().done(function() {
            // Wire up Send button to call NewContosoChatMessage on the server.
            
            //tableroHub.server.hello('hello world!');
        });

        var tablero;
        $(function() {
            tablero = new Tablero('c');
            tablero.onMouseDown = function (x, y) {
                
                tableroHub.server.startPaint(x,y);
            };
            tablero.onMouseMove = function(x, y) {
                tableroHub.server.draw(x, y);
            };
            
            tablero.onMouseUp = function() {
                tableroHub.server.endPaint();
            }

            $('.color').click(function () {
                var color = $(this).find('i').css('color');
                tablero.changeColor(color);
                tableroHub.server.changeColor(color);
            });

            $('.reset').click(function() {
                tablero.createNew(900, 400, 'c');
                tableroHub.server.createNewTablero();
            });
        });
    </script>
}
